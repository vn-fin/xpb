syntax = "proto3";

option go_package = "xpb/brokers";


service BrokerGatewayService {
  rpc Login(LoginRequest) returns (LoginResponse);
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  rpc CreateFutureOrder(CreateFutureOrderRequest) returns (CreateOrderResponse);
  rpc GetOrderById(GetOrderRequest) returns (GetOrderResponse);
  rpc GetPendingOrders(GetPendingOrdersRequest) returns (GetPendingOrdersResponse);
  rpc GetListOrders(GetListOrdersRequest) returns (GetListOrdersResponse);
  rpc GetOrdersBySession(GetOrdersBySessionRequest) returns (GetOrdersBySessionResponse);
  rpc CancelOrder(CancelOrderRequest) returns (CancelOrderResponse);
  rpc UpdateOrder(UpdateOrderRequest) returns (UpdateOrderResponse);
  rpc GetPortfolio(GetPortfolioRequest) returns (GetPortfolioResponse);
  rpc GetAccountBalance(GetAccountBalanceRequest) returns (GetAccountBalanceResponse);
}

/* OrderInfo - matches xno_execution.gateway.credential_orders table */
message OrderInfo {
  string order_id = 1;
  string user_id = 2;
  string credential_id = 3;
  string symbol = 4;
  string symbol_type = 5;
  string side = 6;
  string order_type = 7;
  double order_price = 8;
  double quantity = 9;
  double filled_qty = 10;
  double remaining_qty = 11;
  string status = 12;
  int64 created_at = 13;
  int64 updated_at = 14;
}

/* Login */
message LoginRequest {
  string credential_id = 1;
}

message LoginResponse {
  bool success = 1;
  string message = 2;
  string access_token =3;
}

/* Create Order - matches models.CreateOrderRequest */
message CreateOrderRequest {
  string access_token = 1;
  string group_id = 2;
  string session_id = 3;
  string symbol = 4;
  string order_side = 5;
  string order_type = 6;
  double price = 7;
  int64 quantity = 8;
}

message CreateOrderResponse {
  bool success = 1;
  string message = 2;
  string order_id = 3;
  OrderInfo order = 4;
}

/* Get Order - matches models.GetOrderRequest */
message GetOrderRequest {
  string access_token = 1;
  string group_id = 2;
  string order_id = 3;
}

message GetOrderResponse {
  bool success = 1;
  string message = 2;
  OrderInfo order = 3;
}

/* Cancel Order - matches models.CancelOrderRequest */
message CancelOrderRequest {
  string access_token = 1;
  string group_id = 2;
  string order_id = 3;
}

message CancelOrderResponse {
  bool success = 1;
  string message = 2;
}

/* Portfolio */
message PortfolioItem {
  string symbol = 1;
  int64 quantity = 2;
  double avg_price = 3;
  double market_price = 4;
}

message GetPortfolioRequest {
  string group_id = 1;
}

message GetPortfolioResponse {
  bool success = 1;
  string message = 2;
  repeated PortfolioItem items = 3;
}

/* Account Balance - matches models.GetAccountBalanceRequest */
message GetAccountBalanceRequest {
  string access_token = 1;
  string group_id = 2;
}

message GetAccountBalanceResponse {
  bool success = 1;
  string message = 2;
  double cash = 3;
  double equity = 4;
}

/* Pending Orders - matches models.GetPendingOrdersRequest */
message GetPendingOrdersRequest {
  string access_token = 1;
  string group_id = 2;
}

message GetPendingOrdersResponse {
  repeated GetOrderResponse pending_orders = 1;
}

message GetOrdersBySessionRequest{
  string group_id = 2;
  string session_id = 3;
}

message GetOrdersBySessionResponse{
  bool success = 1;
  string message = 2;
  repeated OrderInfo orders = 3;
}

message GetListOrdersRequest {
  string access_token = 1;
  string credential_id = 2;
}

message GetListOrdersResponse {
  repeated GetOrderResponse pending_orders = 1;
}



/* Update Order - cancel old order, create new order with updated price */
message UpdateOrderRequest {
  string access_token = 1;
  string group_id = 2;
  string order_id = 3;
  double price = 4;
}

message UpdateOrderResponse {
  bool success = 1;
  string message = 2;
  string order_id = 3;
  OrderInfo order = 4;
}

message CreateFutureOrderRequest {
  string access_token = 1;
  string credential_id = 2;
  string symbol = 3;
  string order_side = 4;
  string order_type = 5;
  double price = 6;
  int64 quantity = 7;
}
